# YADRO_TATLIN

**Консольная программа поддерживает работу из консоли через параметры**  
in - имя входной ленты   
out - имя выходной ленты  
cfg - имя файла конфигурации (.json)  

```
YADRO.exe --help
All Options:
  --in arg              tape_in_filename
  --out arg             tape_out_filename
  --cfg arg             (additional option) cfg_filename
  --help                produce help message
```  
Параметры in и out - обязательные, а cfg - дополнительный.  
Если не будет указан cfg параметр, то данные будут считаны из cfg.json.
  
  
**Данные, записанные во входной и выходной файлы должны быть записаны в бинарном виде(по 4 байта без пропусков).**

**Файлы**  
- Файл Source.cpp - основной, где происходит обработка параметров командной строки и вызов сортировки.  
- Файл TapeController.h - интерфейс для работы с устройством типа лента.  
  * *Конструктор* принимает имя файла конфигурации, парсит json и записывает значения полей в параметры.  
  * *move_left* принимает дескриптор файла. Смещает seek влево на 4 байта  
  * *move_right* принимает дескриптор файла. Смещает seek вправо на 4 байта  
  * *get_data* принимает дескриптор файла. Считывает 4 байта и возвращает по return. Смещает seek влево на 4 байта для того, что бы seek не двигался после read.  
  * *set_data* принимает дескриптор файла и значение, которое необходимо записать. Записывает 4 байта и возвращает. Смещает seek влево на 4 байта для того, что бы seek не двигался после read.  
- Файл TapeSort.h содержит класс, реализующий алгоритм сортировки данных с входной ленты на выходную.  
  * Входной файл делится на N/M файлов размера M. Сортируются и склеиваются.  
    * Считывается M байт из входного файла в vector<int>.  
    * Сортируется  
    * Если N/M > 1, происходит запись вектора в файл Tape_tempX.txt, где X - номер temp файла. Если N/M = 1, то запись происходит сразу в выходной файл.  
    * По 1 элементу считываются данные из 2-ух файлов. И происходит mergesort. Результат записывается в новый temp файл, если ещё есть temp файлы. Если их нет, то сразу в выходной файл.  
  
**Тесты:**  
- Файл Test_funcs.h - вспомогаттельный файл для тестов. Генерирует входной файл.
- Файл Test.cpp - файл с unit тестами (BOOST).
    * *Проверка метода move_left*. В for происходит смещение влево с конца файла до начала (N раз). Проверяется, что seek каждый раз уменьшается на 4.
    * *Проверка метода move_right*. В for происходит смещение вправо с начала файла до конца (N раз). Проверяется, что seek каждый раз увеличивается на 4.
    * *Проверка метода get_data*:
      * Генерируется vector<int> размера N и все элементы записываются во входную ленту. Поэлементно считывается с начала до конца значение из файла и проверяется с тем, что записано в векторе.
      * Генерируется vector<int> размера N и все элементы записываются во входную ленту. Поэлементно считывается с конца до начала значение из файла и проверяется с тем, что записано в векторе.
      * Генерируется vector<int> размера N и все элементы записываются во входную ленту. N раз считывается значение из файла без смещения. Должно считываться одно и тоже значение.
    * *Проверка метода set_data*
      * Генерируется vector<int> размера N и все элементы записываются во входную ленту. Поэлементно записывается тестовая константа, считывает записанное значение, которое должно быть равно этой константе с начала до конца.
      * Генерируется vector<int> размера N и все элементы записываются во входную ленту. Поэлементно записывается тестовая константа, считывает записанное значение, которое должно быть равно этой константе с конца до начала.
      * Генерируется vector<int> размера N и все элементы записываются во входную ленту. N записывается тестовая константа, считывается значение из файла без смещения. Должно считываться одно и тоже значение и они должны совпадать.
    * *Проверка полной сортировки*:
      * Генерируется vector<int> размера N и записывается во входной файл. Происходит полная сортировка (TapeSort.h). Сортируется сгенерированный ранее вектор. По 1 элементу с начала до конца читается значение из файла и проверяется с тем, что записано в векторе. Значения должны совпадать.
      * Константный vector<int> размера N = 40, M = 10 и записывается во входной файл. Происходит полная сортировка (TapeSort.h). Сортируется сгенерированный ранее вектор. По 1 элементу с начала до конца читается значение из файла и проверяется с тем, что записано в векторе. Значения должны совпадать.
      * Константный vector<int> размера N = 36, M = 10 и записывается во входной файл. Происходит полная сортировка (TapeSort.h). Сортируется сгенерированный ранее вектор. По 1 элементу с начала до конца читается значение из файла и проверяется с тем, что записано в векторе. Значения должны совпадать.
      * Константный vector<int> размера N = 1, M = 1 и записывается во входной файл. Происходит полная сортировка (TapeSort.h). Сортируется сгенерированный ранее вектор. По 1 элементу с начала до конца читается значение из файла и проверяется с тем, что записано в векторе. Значения должны совпадать.
      * Пустой vector<int> размера N = 0, M = 0 и записывается во входной файл. Происходит полная сортировка (TapeSort.h). Сортируется сгенерированный ранее вектор. По 1 элементу с начала до конца читается значение из файла и проверяется с тем, что записано в векторе. Ошибка "Not enough RAM" 
